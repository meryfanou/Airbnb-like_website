<%- include("../../partials/header_tenant_mail") %>

<div class="mail_bg_img" style="background-image:url('<%=apartment.main_image.url%>'); margin-top:-2%;">
	<div style="background-color:rgba(255,255,255,0.6); height:100%; overflow:auto;">

		<br><div class="container">
			<!-- if(error) checks if error is undefined or not (not just empty) -->
			<% if(error && error.length > 0){ %>
				<div class="alert alert-danger" role="alert">
					<%= error %>
				</div>
			<% } %>
			<% if(success && success.length > 0){ %>
				<div class="alert alert-success" role="alert">
					<%= success %>
				</div>
			<% } %>
			<% if(warning && warning.length > 0){ %>
				<div class="alert alert-warning" role="alert">
					<%= warning %>
				</div>
			<% } %>
		</div>

		<h3 style="color:white; background-color:crimson; border-radius:25px; width:40%; text-align:center;
					padding:11px; position:relative; top:5%; left:30%; right:30%;">
			Conversation with <%= host.firstname %> <%= host.lastname %> about <%= apartment.name %>
		</h3>

		<p style="margin-left:3%;">
			<% var str_host = JSON.stringify(host); %>
			<a href="/messages/<%= currentUser._id %>/<%= apartment._id %>/new?recipient=<%=str_host%>"
			   style="color:crimson; font-size:160%; text-decoration:none; opacity:0.9;">
				<i class="fas fa-plus"></i><strong> compose</strong>
			</a>
		</p>

	<div class="row" style="text-align:center; padding:5%;">
		<% if(conversation.length > 0){ %>
			<ul style="list-style-type:none;">
				<% var i = 0;
				conversation.forEach(function(message){	%>
					<li>
						<h4 style="margin-left:25%;">
							<div style="display:flex; align-items:flex-start;">
								<strong>from:</strong> <%= message.sender.email %>
							</div>
							<div style="display:flex; align-items:flex-end;">
								<strong style="margin-left:53%; margin-top:-10%;">
									<%= message.date %></strong>
							</div>
						</h4>
						<h4 style="margin-left:25%;">
							<div style="display:flex; align-items:flex-start;">
								<strong>subject:</strong> <%= message.subject %>
							</div>
							<div style="display:flex; align-items:flex-end;">
								<a onclick="browsMessage(<%=i%>)"
									style="transform:rotate(90deg); text-decoration:none; cursor:pointer;
											color:rgba(0,0,0,0.7); margin-left:62%; margin-top:-10%;">
									&nbsp;&#10095;</a>
							</div>
						</h4>
						<h4 id="message<%=i%>"
							style="display:none; margin-left:-20%; transition: display 0.5s;">
							<p style="margin-left:38%; margin-right:22%; width:40%;">
								<br><%= message.content %><br>
							</p>
							<form method="POST" action="/messages/<%=currentUser._id%>/<%=apartment._id%>/<%=message._id%>?_method=DELETE">
								<button style="border:none; background-color:transparent;
											   color:firebrick; margin-left:50%;">
									<i class="fas fa-trash-alt"></i> <strong>Delete</strong>
								</button>
							</form>
						</h4>
						<svg height="1" width="600" style="position:relative; top:-10px; left:-10px;">
							<line x1="10" y1="0" x2="600" y2="0" style="stroke:rgb(0,0,0,0.5);stroke-width:2;" />
						</svg><br>
					</li>
					<% i += 1;
				}); %>
			</ul>
		<% } %>
	</div>
	</div>
</div>

<script>
	function browsMessage(i){
		var message = document.getElementById("message"+i);

		if(message.style.display == "none"){
			message.style.display = "block";
		}else if(message.style.display == "block"){
			message.style.display = "none";
		}
	}
</script>

<%- include("../../partials/footer") %>