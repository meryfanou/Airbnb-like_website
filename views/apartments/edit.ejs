<%- include("../partials/header") %>

<p style="position: relative; left:1%; top:10%; font-size:115%;">
	<a href="/users/<%= currentUser._id %>/host">Host Page</a>
</p>

<div class="container">
	<div class="row">
		<h1 style="text-align: center;"> Edit <%= apartment.name %> </h1><br>
		<form action="/apartments/<%= apartment._id %>?_method=PUT" method="POST"
			  enctype="multipart/form-data">
			<div class="col-lg-12">
				<label for="image">Main Image:</label>
				<div class="form-group">
					<div class="thumbnail">
						<img src= "<%= apartment.main_image.url %>"
							 style="object-fit:cover; width:auto; height:450px;"/><br>

						<label for="new_main_image">Load new image</label>
						<input type="checkbox" id="new_main_image" onclick="browseButton()"
							   name="new_main_image">
						<input type="file" id="image" name="images" accept="image/*"
							   style="display: none;">

						<script>
							function browseButton(){
								var	checkbox = document.getElementById("new_main_image");
								var button = document.getElementById("image");

								if(checkbox.checked == true){
									button.style.display = "block";
								}else{
									button.style.display = "none";
								}
							}
						</script>
					</div>
				</div>
			</div>

			<div class="col-lg-8" style="float: left; width: 20%;">
			</div>
			<div class="col-lg-8" style="float: left; width: 60%;">
				<div class="form-group">
					<label for="name">Name:</label>
					<input class="form-control" type="text" name="apartment[name]" id="name"
						   value="<%= apartment.name %>"/>
				</div>

				<div class="form-group">
					<label for="bedrooms">Number of bedrooms:</label>
					<input class="form-control" type="number" name="place[bedrooms]" min="0" step="1"
						   id="bedrooms" value="<%= apartment.place.bedrooms %>"/>
				</div>

				<div class="form-group">
					<label for="beds">Number of beds:</label>
					<input class="form-control" type="number" name="place[beds]" min="0" step="1"
						   id="beds" value="<%= apartment.place.beds %>"/>
				</div>

				<div class="form-group">
					<label for="bathrooms">Number of bathrooms:</label>
					<input class="form-control" type="number" name="place[bathrooms]" min="0" step="1"
						   id="bathrooms" value="<%= apartment.place.bathrooms %>"/>
				</div>

				<div class="form-group">
					<label for="room_type">Private Room</label>
					<input type="radio" name="place[room_type]" id="room_type" value="Pivate Room"
						   style="position: relative; left: 10px"
						   <% if(apartment.place.room_type == "Private Room"){ %>
								checked
							<% } %>/>
				</div>

				<div class="form-group">
					<label for="room_type">Shared Room</label>
					<input type="radio" name="place[room_type]" id="room_type" value="Shared Room"
						   style="position: relative; left: 10px" 
						   <% if(apartment.place.room_type == "Shared Room"){ %>
								checked
					   		<% } %>/>
				</div>

				<div class="form-group">
					<label for="room_type">Apartment</label>
					<input type="radio" name="place[room_type]" id="room_type" value="Apartment"
						   style="position: relative; left: 30px"
						   <% if(apartment.place.room_type == "Apartment"){ %>
								checked
						   <% } %>/>
				</div>

				<div class="form-group">
					<label for="living_room">Living Room</label>
					<input type="checkbox" name="place[living_room]" id="living_room" value="True"
						   style="position: relative; left: 13px"
						   <% if(apartment.place.living_room == "True"){ %>
								checked
							<% } %>/>
				</div>

				<div class="form-group">
					<label for="floor">Floor Number:</label>
					<input class="form-control" type="text" name="place[floor]" id="floor"
						   value="<%= apartment.place.floor %>"/>
				</div>

				<div class="form-group">
					<label for="area">Area:</label>
					<input class="form-control" type="number" name="place[area]" min="0.01" step="0.01"
						   id="area" value="<%= apartment.place.area %>"/>
				</div>

				<div class="form-group">
					<label for="description">Description:</label>
					<input class="form-control" type="text" name="apartment[description]"
						   id="description" value="<%= apartment.description %>"/>
				</div>

				<div class="form-group">
					<label for="smoking">Smoking</label>
					<input type="checkbox" name="renting_rules[smoking]" id="smoking" value="True"
						   style="position: relative; left: 10px"
						   <% if(apartment.renting_rules.smoking == "True"){ %>
								checked
						   <% } %>/>
				</div>

				<div class="form-group">
					<label for="pets">Pets</label>
					<input type="checkbox" name="renting_rules[pets]" id="pets" value="True"
						   style="position: relative; left: 38px"
						   <% if(apartment.renting_rules.pets == "True"){ %>
								checked
						   <% } %>>
				</div>

				<div class="form-group">
					<label for="events">Events</label>
					<input type="checkbox" name="renting_rules[events]" id="events" value="True"
						   style="position: relative; left: 23px"
						   <% if(apartment.renting_rules.events == "True"){ %>
								checked
						   <% } %>/>
				</div>

				<div class="form-group">
					<label for="rent_days_min">Minimum renting days:</label>
					<input class="form-control" type="number" name="renting_rules[rent_days_min]"
						   min="1" step="1" id="rent_days_min"
						   value="<%= apartment.renting_rules.rent_days_min %>"/>
				</div>

				<div class="form-group">
					<label for="wifi">Wifi</label>
					<input type="checkbox" name="facilities[wifi]" id="wifi" value="True"
						   style="position: relative; left: 70px"
						   <% if(apartment.facilities.wifi == "True"){ %>
								checked
						   <% } %>>
				</div>

				<div class="form-group">
					<label for="air_conditioning">Air Condition</label>
					<input type="checkbox" name="facilities[air_conditioning]" id="air_conditioning"
						   value="True" style="position: relative; left: 8px"
						   <% if(apartment.facilities.air_conditioning == "True"){ %>
								checked
						   <% } %>>
				</div>

				<div class="form-group">
					<label for="heating">Heating</label>
					<input type="checkbox" name="facilities[heating]" id="heating"
						   value="True" style="position: relative; left: 45px"
						   <% if(apartment.facilities.heating == "True"){ %>
								checked
						   <% } %>>
				</div>

				<div class="form-group">
					<label for="kitchen">Kitchen</label>
					<input type="checkbox" name="facilities[kitchen]" id="kitchen" value="True"
					   style="position: relative; left: 44px"
						<% if(apartment.facilities.kitchen == "True"){ %>
							checked
						<% } %>/>
				</div>

				<div class="form-group">
					<label for="tv">TV</label>
					<input type="checkbox" name="facilities[tv]" id="tv" value="True"
						   style="position: relative; left: 75px"
						   <% if(apartment.facilities.tv == "True"){ %>
								checked
							<% } %>/>
				</div>

				<div class="form-group">
					<label for="parking">Parking</label>
					<input type="checkbox" name="facilities[parking]" id="parking" value="True"
						   style="position: relative; left: 43px"
						   <% if(apartment.facilities.parking == "True"){ %>
								checked
							<% } %>/>
				</div>

				<div class="form-group">
					<label for="elevator">Elevator</label>
					<input type="checkbox" name="facilities[elevator]" id="elevator" value="True"
						   style="position: relative; left: 40px"
						   <% if(apartment.facilities.elevator == "True"){ %>
								checked
						   <% } %>>
				</div>

				<div class="form-group">
					<label for="address">Address:</label>
					<input class="form-control" type="text" name="location[address]" id="address"
						   value="<%= apartment.location.address %>">
				</div>

				<div class="form-group">
					<label for="neighbourhood">Neighbourhood:</label>
					<input class="form-control" type="rext" name="location[neighbourhood]"
						   id="neighbourhood" value="<%= apartment.location.neighbourhood %>">
				</div>

				<div class="form-group">
					<label for="transportation">Means of transportation:</label>
					<input class="form-control" type="text" name="location.transportation"
						   id="transportation" value="<%= apartment.location.transportation %>">
				</div>

				<div class="form-group">
					<label for="price_min">Minimum price per night:</label>
					<input class="form-control" type="number" name="apartment[price_min]" min="0.01"
						   step="0.01" id="price_min" value="<%= apartment.price_min %>">
				</div>

				<div class="form-group">
					<label for="extra_charge_per_guest">Extra charge per guest:</label>
					<input class="form-control" type="number" name="apartment[extra_charge_per_guest]"
						   min="0.00" step="0.01" id="extra_charge_per_guest"
						   value="<%= apartment.extra_charge_per_guest %>">
				</div>

				<div class="form-group">
					<label for="avail_from">Available from:</label>
					<input class="form-control" type="date" name="apartment[availability_from]"
						   id="avail_from" value="<%= apartment.availability_from %>">
				</div>

				<div class="form-group">
					<label for="avail_to">Available until:</label>
					<input class="form-control" type="date" name="apartment[availability_to]"
						   id="avail_to" value="<%= apartment.availability_to %>">
				</div>
				<div class="form-group">
					<label for="capacity">Maximum number of guests:</label>
					<input class="form-control" type="number" name="apartment[capacity]" min="1"
						   step="1" id="capacity" value="<%= apartment.capacity %>"><br>
				</div>
			</div>

			<div class="col-lg-12" style="width: 90%;">
				<!-- Container for the image gallery -->
				<div class="container">
					<% if(apartment.images.length > 0){ %>
					<label>Photos:</label>
					<% } %>
					<div class="thumbnail">
						<% if(apartment.images.length > 0){ %>
						<div class="row"
							style="background-color: rgba(0,0,0,0.7); margin-left: auto; margin-right: auto;">
							<div class="col-lg-8">
							<!-- Full-width images with number text -->
								<%	var i = 1;
									for(var image of apartment.images){ %>
									<div class="mySlides">
									    <div class="numbertext">
											<%= i %> / <%= apartment.images.length %>
										</div>
										<img src="<%= image.url %>"
											 style="width:100%; height:500px;object-fit:cover;">
										<!-- Next and previous buttons -->
										<a class="prev" onclick="plusSlides(-1)">&#10094;</a>
										<a class="next" onclick="plusSlides(1)">&#10095;</a>

										<!-- Remove checkbox -->
										<label for="image<%= i %>"
											   style="position: relative; left: 1025px; font-size:110%;
													  color:red; top:30px;">
											Remove
										</label>
										<input type="checkbox" name="deleteImages[]" id="image<%= i %>"
											   style="position: relative; left: 1030px; top:px;"
											   value="<%= image.public_id %>">
									</div>
									<% i += 1;
									} %>
							</div>
							<!-- Thumbnail images -->
							<%	var i = 1;
								for(var image of apartment.images){ %>
								<div class="column">
									<img class="demo" src="<%= image.url %>"
										 style="width:186px; height:123px;"
										 onclick="currentSlide(<%= i %>)">	
								</div>
							<%	i += 1;
							} %>
						</div><br>

						<script>
							var slideIndex = 1;
							showSlides(slideIndex);

							function plusSlides(n) {
							  showSlides(slideIndex += n);
							}

							function currentSlide(n) {
							  showSlides(slideIndex = n);
							}

							function showSlides(n) {
							  var i;
							  var slides = document.getElementsByClassName("mySlides");
							  var dots = document.getElementsByClassName("demo");
							  var captionText = document.getElementById("caption");
							  if (n > slides.length) {slideIndex = 1}
							  if (n < 1) {slideIndex = slides.length}
							  for (i = 0; i < slides.length; i++) {
								  slides[i].style.display = "none";
							  }
							  for (i = 0; i < dots.length; i++) {
								  dots[i].className = dots[i].className.replace(" active", "");
							  }
							   slides[slideIndex-1].style.display = "block";
							   dots[slideIndex-1].className += " active";
							   captionText.innerHTML = dots[slideIndex-1].alt;
							}
						</script>
						<% } %>
						<div class="form-group">
							<label for="images">Add more photos:</label>
							<input type="file" name="images" accept="image/*" multiple>
							<p>
								To select multiple files, hold down the CTRL or SHIFT key while selecting.
							</p>
						</div>
					</div>
				</div>
			</div>

			<div class="col-lg-4" style="float: left; width: 37%">
			</div>
			<div class="col-lg-4" style="float: left; width: 25%">
				<div class="form-group">
					<button class="btn btn-lg btn-primary btn-block">Submit</button>
				</div>
			</div>
		</form>
	</div>
</div>

<%- include('../partials/footer') %>